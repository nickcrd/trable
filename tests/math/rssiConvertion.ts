import * as mocha from 'mocha';
import { expect } from 'chai'
import DistanceCalculationState from "../../src/math/state/DistanceCalculationState";
import logger from "../../src/utils/logger";

describe("RSSI Convertion", () => {
/*
    it("should calculate distance of RSSI measured at 1m", () => {

        const distCalcState = new DistanceCalculationState(txPower, 4)


    })
*/

    it("should generate an average", async () => {

        // These are real measurements taken at 1m distance between a Raspberry Pi Zero W running trable-utils and an iPhone 11 Pro Max advertising with the Debug app; Measurements taken with 15 Seconds
        const measurements = [-52, -52.5004995004995, -58.01863162416007, -56.75521737431375, -55.18564286548, -57.69969579905454, -59.79529091844581, -61.76172997068523, -60.39636567560262, -61.19941499443346, -60.20845719232466, -59.55816109928887, -59.00447117809331, -58.685907014067205, -59.086604799643084, -59.72696159585371, -59.058093208257475, -58.52555224371253, -58.74703892888021, -58.269114248239184, -57.95361237815054, -57.548412391740555, -57.17616347845679, -56.888496603059465, -56.513480937203106, -56.16549510317711,
            -55.94674488070385, -55.74271163251372, -55.450061898445874, -55.22623941332893, -55.016205946997395, -54.818784400893506, -54.63293703574318, -54.457744763303175, -54.292390017468094, -54.136142507906754, -53.98834730989053, -53.84841485885295, -53.7158125066117, -53.59005736471127, -53.37855229295935, -53.26943997802218, -53.21144401662734, -53.11078841717321, -52.92432123263692, -52.882524482026454, -52.797641885033755, -52.7167982493516, -52.684639338057124, -52.47492355734749, -52.409027987172415, -52.435382782156715, -52.23791431025774, -52.09397876932573, -52.134198012405406, -51.95091105923511, -51.90880230157402, -51.912836452028586, -51.960880378621816, -51.87430260134071, -51.79161508052225, -51.624467609852026, -51.55290441803916, -51.396485006398194, -51.42304004227648, -51.27250287054068, -51.216567964730345, -51.07524035883835, -51.15977547333301, -51.02104940113605, -50.88845826226846, -50.84947654811777, -50.812215601663915, -50.82045036208539, -50.872164126696426, -50.74626974680566, -50.669741190778474, -50.68421187151935, -50.61042819698406, -50.627492405488454, -50.687603415044556, -50.56991054301216, -50.54495643656322, -50.477316035706224, -50.368865966172415, -50.48403969589645, -50.594163074966204, -50.48062506626682, -50.459591089596735, -50.43947886891737, -50.55152387779857, -50.352365408883216, -50.24943909031693, -50.28227802309846, -50.40118056663398, -50.47112771524953, -50.494264724038935, -50.34140283326732, -50.238977427382274, -50.184779323322054, -50.39541259344118, -50.20314709986473, -50.54419292699479, -50.60787095930002, -50.712502705447534, -51.07499261577958, -50.94049617339502, -50.85562226469208, -50.774461499243934, -50.784325947769425, -51.05618030346466, -51.27240583633576, -51.479172798432096, -51.80810278433265, -51.991437894390515, -52.25422435033631, -52.418046195263194, -52.53096761982278, -52.85762331808256, -53.169991530688456, -53.20629139038406, -53.32847192227597, -53.489042648470395, -53.730058329131424, -53.873065262731245, -53.92235026645628, -54.013213333069764, -54.14383594817238, -54.225012334908584, -54.30263846869211, -54.42060290535844, -54.53340821047545, -54.597546887894495, -54.658880505705305, -54.97993004500845, -55.02454076987611, -55.06720049470501, -55.41412505177576, -55.43974705968438, -55.42051566089296, -55.358392480956425, -55.86751270831995, -55.829573958823225, -55.79329439434047, -55.7586014510855, -55.72542573909925, -55.693700903396504, -55.61963079305583, -56.07359220434785, -56.50770054049949, -56.9228240507679, -56.79500120918232, -56.62903578532538, -56.99512008147292, -56.82040299769814, -56.74079201143123, -56.62093002365214, -56.550042533194905, -56.700918136835504, -56.62653257610275, -56.642865273234975, -56.96461178666945, -56.878694244086866, -56.75280152737706, -56.63241443254041, -56.604757323841916, -56.62204230092628, -56.59483879545554, -56.48135984462321, -56.37284362432668, -56.40027077746577, -56.426498469967626, -56.320381490817944, -56.13144017354598, -56.12569195922119, -56.16392768067833, -56.20049125554268, -55.97306051477996, -55.755575904766516, -55.591335002679706, -55.39054422963082, -55.19853455160302, -55.05865449388674, -54.9248917489808, -55.05937405688023, -54.88184730302234, -54.755816790851995, -54.67903045762603, -54.82426489952046, -54.963147868893216, -54.877294422452245, -54.7514630243908, -54.67486709526128, -54.82028360668591, -54.871875602081396, -54.921211348199, -54.924656976103854, -54.97168445825095, -54.929190228656786, -54.88855437979757, -54.893428179828376, -54.766891216887274, -54.689620576671295, -54.96558949443674, -55.22948959003816, -55.656778821350194, -55.71552129434532, -56.51514797679735, -56.44888670854649, -56.2980581356569, -56.5911510700376, -56.783961227875146, -57.0995369246835, -57.13891646117875, -57.43896906387821, -57.201109137947974, -56.97365143063338, -57.018536259263136, -56.84279546649994, -56.89340295860026, -56.59193694676007, -56.39111988650063, -56.50521283699582, -56.61431621307785, -56.674915682854085, -56.689132445315515, -56.484064779514014, -56.20050016614629, -56.14799924628293, -56.09779432493558, -55.91858737649448, -55.922147757192825, -55.92555243340434, -55.79761059878479, -55.67526398539935, -55.68946551567763, -55.74677851553233, -55.71411999531822, -55.55169209948333, -55.39636758787707, -55.37903342706753, -55.406189871643114, -55.213496003331734, -55.16042674261913, -55.10967833539796];

        logger.debug("Amount of Measurements: " + measurements.length)

        const calcState = new DistanceCalculationState(-54.5, 4)

        measurements.forEach(measurement => calcState.addMeasurement(measurement))

        logger.debug("Added all measurements")

        // @ts-ignore
        logger.debug("Avg RSSI: " + calcState.averageRSSI())

        logger.debug(await calcState.calculateDistanceInMeters())


    })

    it("should caluclate distance for measurements at 2m correctly", async () => {

        // These are real measurements taken at 2m distance between a Raspberry Pi Zero W running trable-utils and an iPhone 11 Pro Max advertising with the Debug app; Measurements taken within 15 Seconds
        const measurements = [-49,-49.5004995004995,-49.6675536335723,-48.996010965116604,-48.996818303862334,-49.50646969708001,-49.139166625040765,-49.37982992208928,-49.80007855718167,-49.50435139802534,-49.455349474566944,-49.59469693477859,-49.62891570721269,-49.65843624869185,-49.6841911308786,-49.706879494975524,-49.7270357418811,-49.81116304052729,-49.82320088801401,-49.957490392683624,-50.079790948417006,-50.19168511784908,-50.4650170161065,-50.77262539574538,-50.94832643850192,-51.057938079701195,-51.212439929698476,-51.408243866161946,-51.489360077296624,-51.6659329362325,-51.682535228844934,-51.79645306179491,-51.95235889336306,-52.00287962200975,-52.05056347317754,-52.23799254999182,-52.321029669422295,-52.49330125711507,-52.79620782142754,-52.80564437651821,-52.90675800249638,-52.86516191691397,-52.73426339252513,-52.74635860150224,-52.98466610379271,-52.894921768970256,-52.80948018115353,-52.99793643619197,-52.90829969296385,-53.091471557945844,-53.26609397071538,-53.38801435162039,-53.28169713661375,-53.53589380057336,-53.73406020803668,-53.70151613090954,-53.93614645837064,-54.1601471450042,-54.550797882377466,-54.48232627384271,-54.37281492530179,-54.620880652506216,-54.813795399427306,-55.39432842894723,-55.55298022542242,-55.96843771953088,-55.969825090220624,-56.234775245931246,-55.873105324468995,-55.70306137881421,-56.15498474627696,-55.79717921079698,-56.15698298274846,-56.413212178049,-56.132044404929594,-56.389252070745556,-56.67896160400122,-56.38631499366576,-56.71986308581573,-56.381713989033344,-56.058420856150455,-56.09965355925878,-55.788788086000444,-55.710472387044916,-55.54803813054378,-55.78668913605908,-55.44586638220641,-55.11998523377921,-54.76462386801578,-54.42483523359546,-54.36248633341866,-54.30286878567704,-54.0708449853403,-53.848982728099315,-53.549334171726265,-53.26280572387135,-53.163812909478295,-52.93791411036804,-52.89688476160549,-52.85765123517861,-52.68890513833194,-52.70251314573879,-52.584301241150676,-52.4712620747859,-52.319429039844685,-52.17423930496564,-52.254095860349736,-52.155505649824214,-52.061228656172936,-52.10228799445595,-52.18528804726231,-52.22092072339745,-52.08004991890905,-51.945341229393016,-51.86026057735367,-51.91010745890613,-51.95777401012366,-51.828416136200524,-51.70471627778354,-51.63016137814634,-51.515133047070755,-51.711274988247894,-51.9425722567972,-51.8138820837242,-51.6908203631162,-51.66060824608445,-51.63171748066799,-51.604090268371735,-52.01500545734012,-52.014349218616964,-51.96998841166979,-52.321166564578654,-52.26338779020695,-52.645466898315036,-52.48603951545354,-52.37731753585662,-52.273350390148565,-52.21766304801881,-52.60174007251324,-52.444225660188906,-52.86212678235734,-52.69322511973695,-52.57544287611556,-52.41907886661551,-52.40075139645742,-52.86428546752805,-53.35128047602337,-53.81697771249889,-54.30604129770816,-54.0739939340779,-53.9832926613396,-54.46508246889724,-54.22607998158075,-53.997529749779034,-53.910172532594686,-54.395159704845184,-54.858937048239184,-55.47736255114247,-55.36902105014235,-56.14006947807703,-56.046478700432715,-56.00071348262003,-56.00068228018411,-56.744106245531135,-57.19262287187518,-56.83433841529972,-56.92904835712053,-57.06334895001117,-57.06057853807029,-56.70806879699015,-56.370975224314975,-56.31101897195986,-55.9475568730236,-55.818652682616644,-55.6516532526902,-55.18582927780709,-54.82784208613841,-54.441778045967794,-54.33499286921629,-54.36407532522935,-54.26068829034264,-53.94315990479985,-53.68325039402598,-53.65337011550952,-53.88719184393551,-54.11078795070618,-53.887280194987824,-54.41700023415495,-54.26756612594392,-54.38706240571434,-54.938658227594416,-55.509863900171865,-55.312636090694404,-55.12403355560204,-55.20607433481811,-55.765585209354185,-55.51344152075125,-55.35978979779374,-55.562717976816664,-55.75677159046741,-55.59247842703848,-55.43537022136121,-55.59126053452583,-55.60913574936916,-55.62622923563655,-55.99243549538731,-56.3863591641579,-56.15080000065828,-56.66899560381915,-57.208261735919805,-57.549014233922776,-57.262609213432825,-56.98872941195477,-57.2516175369582,-57.80913666882713,-57.51135583487231,-57.22659771301258,-57.21668801973679,-57.38214185759861,-57.23423220776092,-57.13652356121237,-56.911890345757655,-57.17813883674677,-56.90795314115383,-57.3055714318683,-57.51087071062533,-57.70719173068372,-57.9823922113334,-57.677034474384016,-58.3908791942499,-58.986040595036684,-58.68052330519361,-58.34463452349283,-58.76688816655917,-59.17067558583805,-58.81335120077093,-59.30257175061113,-59.24560698132163,-58.97247073330958,-58.71127942681402,-59.0300336801275,-58.85379007694081,-59.03511436213494,-59.077311260462686,-58.85526755018672,-58.949062144658164,-58.951289786378794,-58.55982716105016,-58.40414688263435,-58.299007436505555,-57.892338235696535,-58.11570925048603];

        logger.debug("Amount of Measurements: " + measurements.length)

        const calcState = new DistanceCalculationState(-54.5, 1)

        measurements.forEach(measurement => calcState.addMeasurement(measurement))

        logger.debug("Added all measurements")

        // @ts-ignore
        logger.debug("Avg RSSI: " + calcState.averageRSSI())

        logger.debug(await calcState.calculateDistanceInMeters())

    })

})